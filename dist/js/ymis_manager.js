!function(){function t(){this.module_class="yandex_money_ind",this.form_root=$(),this.module_price_id=!1,this.submitFormSettings=function(){var t={},e=!0;ymis_manager.form_root=$("#yandex-money-ind-settings"),ymis_manager.form_root.find("input").each(function(){"checkbox"==$(this).attr("type")?t[$(this).attr("name")]=$(this).prop("checked")?1:0:t[$(this).attr("name")]=$(this).val().trim()});var a=ymis_manager.validateFormSettings(t);for(var s in a)ymis_manager.form_root.find("div[parent-name="+s+"]:first").html(a[s].join("<br/>")),a[s].length>0&&(e=!1,"successURL"==s&&ymis_manager.form_root.find("#form_conf_buy_more").addClass("in").css({height:"auto"}));if(e){var n={settings:t};n.form_id=pages_editor.$bottomEditor.data("curSmartObj").id,n.module_class=ymis_manager.module_class,saveMan.add("save_ymis_settings",n)}},this.onSaveSettings=function(t){paneStore.editor.data("curSmartObj").data.wallets[ymis_manager.module_class]||(paneStore.editor.data("curSmartObj").data.wallets[ymis_manager.module_class]={}),paneStore.editor.data("curSmartObj").data.wallets[ymis_manager.module_class].settings=t.settings;var e={};e[ymis_manager.module_class]={settings:t.settings},paneStore.editor.data("curSmartObj").$inputWallets.val(LpmBase64.encode(JSON.stringify(e))),$("#tabEditFrom").find("#frm"+paneStore.editor.data("curSmartObj").data.id+":first").find("input[name=wallets]").val(paneStore.editor.data("curSmartObj").$inputWallets.val())},this.clearFormSettings=function(t){$.inArray(ymis_manager.module_class,sitesMan.modules_list)<0?$("#yandex-money-ind-settings").find(".lock-ind-settings:first").show():$("#yandex-money-ind-settings").find(".lock-ind-settings:first").hide(),t.find("input").each(function(){ymis_manager.form_root.find("div[parent-name="+$(this).attr("name")+"]:first").html(""),"checkbox"==$(this).attr("type")?$(this).prop("checked",!1):$(this).val("")})},this.validateFormSettings=function(t){var e={};for(var a in t)switch(e[a]=new Array,$.inArray(a,["wallet_number","targets","amount"])>=0&&0==t[a].length&&e[a].push("Поле обязательно для заполнения"),a){case"wallet_number":/[^[0-9]/.test(t[a])&&e[a].push("Неверный формат. Допустимы только цифры");break;case"amount":t[a]=t[a].split(",").join("."),/^\.|\d+\..*\.|[^\d\.{1}]/.test(t[a])&&e[a].push("Неверный формат. Допустимы только цифры");break;case"successURL":t[a].length>0&&t[a].indexOf("http://")==-1&&t[a].indexOf("https://")==-1&&e[a].push("неверный формат URL");break;case"targets":t[a].length>150&&e[a].push("максимальное значение поля 150 символов");break;case"formcomment":t[a].length>50&&e[a].push("максимальное значение поля 50 символов")}return e},this.loadFormSettings=function(t){var e=$(),a=$("#yandex-money-ind-settings");if(0!=a.length&&(ymis_manager.clearFormSettings(a),void 0!==t[ymis_manager.module_class]))for(var s in t[ymis_manager.module_class].settings)e=a.find("input[name="+s+"]"),"checkbox"==e.attr("type")?e.prop("checked",1==t[ymis_manager.module_class].settings[s]):e.val(t[ymis_manager.module_class].settings[s])},this.submitLeadForm=function(t,e,a,s){var n=LpmBase64.encode(JSON.stringify({lead_id:e,key:a})),i=$("#ymis_"+t);i.find("input[name=paymentType]").val(s),i.find("input[name=label]").val(n),i.submit()},this.enabledModule=function(){var t=lockScreen("Подключаем модуль!",{show_animation:!0});saveMan.add("enabled_ymis_module",{module_class:ymis_manager.module_class,lock_id:t})},this.afterEnabledModule=function(t){$("#yandex-money-ind-settings").find("#ymis-enabled-text:first").hide(),$("#yandex-money-ind-settings").find("#ymis-msg:first").show(),setTimeout(function(){$("#yandex-money-ind-settings").find(".lock-ind-settings:first").hide()},2e3),$.inArray(ymis_manager.module_class,sitesMan.modules_list)<0&&sitesMan.modules_list.push(ymis_manager.module_class),unlockScreen(t)}}FE.runOnReady(function(){window.ymis_manager=new t})}();